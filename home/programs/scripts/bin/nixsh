#!/usr/bin/env bash
# Nix shell helper which can be used in a shebang

FLAKE_PATH="/etc/nixos"
EXPRESSION="$1"
COMMAND="$2"

nix shell \
    --impure \
    --arg "pkgs" "with import <nixpkgs> { }; \
                  with builtins; \
                  let flake = getFlake (toString $FLAKE_PATH); \
                  in flake.lib.mkPkgs stdenv.system" \
    --expr "$EXPRESSION" \
    -c "$COMMAND" \
    "${@:3}"
